![](https://static001.geekbang.org/resource/image/6c/ec/6c94ad5bc9c0402f53b6ced3d7e65fec.jpg)

## 1. 定义

图的结构很简单，可以分为顶点和边，每一个点连接的边数，我们称之为`度`

进一步的，以微博举例，用户之间还存在单向关注的关系，我们可以对边做出方向的划定，于是有了`入度`和`出度`

更复杂一些，以qq举例，qq亲密度不仅反映了两个用户的好友关系，还记录了两个用户之间的亲密度，这就引入了另外一种图，`带权图`

## 2. 数据结构表示方法

### 2.1 邻接矩阵存储法

邻接矩阵的底层依赖一个二维数组，对于无向图来说，如果i和j之间存在边，我们就将A[i][j]和A[j][i]标记为1，对于有向图来说我们根据情况来决定标记1个还是两个，如果是带权图，数组中存储的就是相应的权重

![](https://static001.geekbang.org/resource/image/62/d2/625e7493b5470e774b5aa91fb4fdb9d2.jpg)

优点

* 简单，直白
* 因为它基于数组，所以在获取两个顶点的关系时，非常高效
* 矩阵的形式存储非常方便计算

缺点

* 对于无向图来说，空间实际上是浪费了一半的
* 如果我们存储的是稀疏图（顶点多，但是边不多），那么邻接矩阵的存储方式就更加浪费时间了

### 2.2 邻接表存储方法

![](https://static001.geekbang.org/resource/image/03/94/039bc254b97bd11670cdc4bf2a8e1394.jpg)

邻接表就属于典型的用时间换空间，它储存空间小，但是查询很浪费时间

和散列表类似，如果拉链过长，我们可以将链表换成其他高效的数据结构，比如红黑树等

## 3. 应用

以微博为例，它是一个有向图

因为社交网络是稀疏网，所以用一个邻接表来存储这种有向图是不够的，我们还需要一个逆邻接表来存储每个用户被哪些用户关注了

![](https://static001.geekbang.org/resource/image/50/a1/501440bcffdcf4e6f9a5ca1117e990a1.jpg)

基础的邻接表不适合快速判断两个用户之间是否是关注与被关注的关系，所以我们选择改进版，将邻接表中的链表改为支持快速查找的跳表，因为跳表的插入删除查找都非常高效

如果数据规模变大，不适合全部存储在内存里怎么办，我们可以通过哈希算法等数据分片方式，把邻接表存储在不同的机器上。当要查询顶点和顶点的关系时，我们就利用同样的哈希算法，先定位顶点所在的机器，然后再在相应的机器上查找

当然我们还有一种解决思路，就是用外部存储（比如硬盘），因为外部存储的空间要比内存富裕很多，数据库是我们经常用来持久化存储关系数据的

## 4.总结

图的基本结构有点和边，和图有关的概念有无相有向图，带权图，度，出度，入度。除此之外，还有图的两种存储方式

邻接矩阵的方式简单直白，查询效率快，计算效率也快,但是空间利用率不足，而且不适合稀疏图。邻接表存储空间小，但是查询效率低，我们可以对链表进行改造，改造成跳表。