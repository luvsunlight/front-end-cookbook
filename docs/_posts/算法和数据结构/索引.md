![](https://static001.geekbang.org/resource/image/2b/10/2bcfe50eece74bbeb969e253f30c4b10.jpg)

## 1. 定义

之前讲的B+树是mysql实现的索引，那么像Redis这种key-value数据库中的索引，又是怎么实现的呢？

为什么需要索引？在实际的软件开发中，业务纷繁复杂，但是本质实际上都是“对数据的存储和计算”，对应到数据结构和算法中，那存储需要的就是数据结构，计算需要的是算法

对于存储的需求，无非是增删查改，这其实并不复杂，但是一旦存储的数据很多，那性能就成了这些系统要关注的重点。`如何节省存储空间，如何提高数据增删查改的效率`，这样的问题就成了设计的重点，而这些系统的实现，都离不开一个东西，那就是索引。索引设计的好坏，直接决定了这些系统是否优秀

### 1.1 索引的需求定义

#### 1.1.1 功能性需求

* 数据是格式化数据还是非格式化数据（对于非格式化数据，我们一般需要做预处理，提取出查询关键词，对关键词建立索引）
* 数据是静态还是动态数据（静态数据只需要考虑查询效率，动态数据我们还需要动态更新索引）
* 索引存储于内存还是硬盘（内存查询效率高）
* 单值查找还是区间查找
* 单关键词查找还是多关键词查找

#### 1.1.2 非功能性需求

* 索引对存储空间的消耗不能太大
* 我们需要考虑索引的维护成本

### 1.2 构建索引常用的数据结构

散列表，红黑树，跳表，B+树，除此之外，位图和布隆过滤器都可以作为辅助索引

散列表增删查改的效率非常好，一般都是构建在内存中

红黑树也非常适合用来构建内存索引

B+树比起红黑树来说，更适合构建存储在磁盘中的索引，因为是一个多叉树，多以高度要小于红黑树，需要的磁盘IO次数非常少，所以大部分的关系型数据库的索引，都是借助B+树来完成的

跳表也支持快速增删查改，而且我们可以通过灵活调整其节点个数和数据个数的比例来平衡索引对内存的消耗及其查询效率。Redis中的有序集合，就是用跳表来实现的。

布隆过滤器和位图也能很好地进行辅助。布隆过滤器有一定的误判率，但是我可以利用它的特点即判断不存在的数据肯定就不存在。而且布隆过滤器最大的优点是内存占用小，我们在查询数据时，可以先用布隆过滤器过滤一遍，这样可以大大增加效率

实际上有序数组也可以拿来做二分查找

## 2. 总结

我们总结了散列表，跳表，红黑树，B+树在索引中的应用。我们可以看到架构设计离不开数据结构和算法，要想成为一个优秀的架构师，数据结构和算法的根基一定要打稳，因为那些看似惊艳的架构设计，实际上，都来源于最常用的数据结构和算法