![](https://static001.geekbang.org/resource/image/29/58/29ba6073707a716c78fde2495c543158.jpg)

## 1. 介绍

Redis数据库是一种键值型数据库，它里面只包含键和值两个部分

此外，Redis主要是作为内存数据库来使用，当然，它也支持存储在硬盘中

常用的数据结构有字符串，列表，字典，集合，有序集合

### 1.1 列表

列表一般有两种实现方法，压缩列表和双向循环链表

#### 1.1.1 压缩列表

压缩列表是一种Redis自己设计的数据结构，也是用连续的内存空间来存储，但是它`允许存储的数据大小`不同。它的压缩也主要是和数组相比，因为数组只能存储相同大小的数据，在使用的时候难免会导致内存占用率不足的情况

![](https://static001.geekbang.org/resource/image/49/b5/49fd8d46eb94f463ace98717f11c2cb5.jpg)

列表中存储的数据量比较小，适用于这样的情况

* 列表中保存的单个数据小于64字节
* 列表中数据个数小于512个

压缩列表这种结构，一方面节省内存，另一方面可以支持不同类型数据的存储，而且因为它和数组类似都是存储在连续空间内，所以访问的效率也很高

#### 1.1.2 双向循环链表

当列表中存储的数据量较大时，我们就要通过双向循环链表来实现了

### 1.2 字典（hash）

字典用来存储键值对，字典也有两种实现方式，压缩列表和散列表

同样的，只有当存储的数据量比较小的时候，redis才使用压缩列表来实现字典类型，条件和上述一致

当不能满足如上条件时，Redis就是用散列表来实现字典类型。Redis使用MurmHash2这种运行速度块随机性好的哈希函数。对应哈希冲突，redis使用链表法来解决，除此之外，Radis还支持散列表的动态扩容，缩容（渐进式）

### 1.3 集合

集合用来存储一组不重复的数据，有两种实现方法，一个是基于有序数组，一个是基于散列表

满足如下条件，则使用有序数组

* 存储的都是整数
* 存储的数据元素个数不超过512个

否则，使用散列表

### 1.4 有序集合

有序集合也是两个实现方法，跳表和压缩列表

当数据满足如下要求，则使用压缩列表

* 数据大小小于64字节
* 元素个数小于128

### 1.5 数据持久化

Redis尽管经常被用作内存数据库，但是它也支持数据存盘，这样机器在断电的时候，存储在Redis里的数据也不会丢失，在机器重新启动的时候，数据也不会丢失

刚才我们讲到，Redis的数据格式有键和值，而值也支持很多数据类型，底层用到了散列表，但是散列表里的指针指向的是内存里的地址。Redis是如何将这样一个跟具体内存地址有关的数据结构存储到磁盘里的呢

这种场景我们称之为数据结构的持久化问题，或者对象的持久化问题，我们可以笼统地理解为“存储到硬盘”

一种解决思路是清楚原有的数据结构，我们只将数据存储到存盘中，当我们需要从磁盘中还原数据时，再将数据还原成原来的数据结构，Redis采取的就是这种思路，这样做在还原的过程会比较耗时1

第二种思路是保留原来的结构

## 2. 总结

Redis底层常用的依赖数据结构，压缩列表，有序数组，链表，散列表，跳表，实际上Redis就是这些常用数据结构的封装

