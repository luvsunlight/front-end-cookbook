
## 内容安全策略（CSP）

### CSP是什么

它是一中用于保护浏览器通信安全的策略。主要功能是指定网页能够从哪些网页加载哪些资源，可以用于防止XSS攻击

### CSP的实现

服务端和浏览器端二选一

* 服务端设置HTTP响应头`Content-Security-Policy: policy`
* 浏览器端设置meta元素`Content-Security-Policy: policy`

### CSP的功能

* 指定有效域
* 指定有效数据类型
* 指定通信协议
* 指定单独JS脚本不能加载来自外域的

## XSS

### XSS的定义

> 跨站脚本攻击XSS(Cross site scripting)，恶意攻击者往web页面中插入恶意js代码，当用户浏览该页面时，嵌入其中的js代码会被执行，从而达到恶意攻击用户的目的

比如说我们再一个博客网站上写博客，如果是正常的博客形式那完全没有问题，可如果我们撰写的是恶意的js脚本，例如获取到document.cookie然后传输到我自己的服务器上，那么我在博客网站上发布的这篇文章每被别人浏览一次，这段代码就被执行一次，访客的信息就会被泄露。

总结就是黑客通过发布文章/评论，将一段特定的js代码隐蔽地输入进去，然后别人再看这篇文章或者评论时，这段代码就执行了，这些恶意代码拥有和原网页一样的权限

!>XSS的本质就是在用户浏览的页面中注入恶意代码以获取隐私信息

### XSS的攻击方式

#### 反射型

发出请求时，xss代码出现在url中，作为输入提交到服务器端，服务器端解析后响应，xss随着响应内容一起返回给浏览器，最后浏览器解析执行xss代码

#### 存储型

存储型xss和反射型的xss差别就在于，存储型的xss提交的代码会存储在服务器端（数据库，内存，文件系统等），下次请求页面时不用再提交xss代码.反射型的XSS攻击，Web服务器不会存储其恶意脚本

#### 基于DOM的XSS攻击

这类型的XSS攻击是不牵涉页面Web服务器的，比如通过各种手段将恶意脚本注入到用户的页面中，比如通过路由器劫持，然后在Web资源传输过程或者在用户使用页面的过程中修改Web页面的数据

### XSS的防御措施

* 编码，对用户输入的数据进行html entity编码
* 过滤，移除用户上传的dom属性，如onerror，移除用户上传的style节点，script节点，iframe节点等
* cookie设置httpOnly
* 充分利用CSP
    * 限制加载其他域下的资源文件
    * 禁止向第三方域提交数据
    * 禁止执行内联脚本和未授权的脚本

### XSS的常见表现形式

img标签是自动触发而受到攻击的，p标签是引诱触发而遭到攻击的，而iframe是广告植入攻击的

## 跨站请求伪造（CSRF）

Cross-site request forery跨站请求伪造，CSRF是借用了当前操作者的权限来偷偷完成该操作，而不是拿到用户的信息。

比如一个支付网站，付账的接口不需要密码，只要访问对应的url就可以完成付账，然后假如一个用户登陆了该网站，然后收到了一封邮件，打开该邮件，就通过img标签中的url完成了付款界面。它这里是利用了共享cookie的特性

和XSS不同的是，CSRF不需要获取用户的信息，它只需要借助用户目前的登录状态Cookie，然后来完成一些有害操作

预防CSRF就是加入各个层级的验证，比如输密码或指纹等

### CSRF的防御措施

* 利用好Cookie的Samesite属性
* 判断请求头中的Referer字段
* 加上额外的验证层，比如CSRF Token

## Refer

* [Web安全之XSS攻防](https://blog.csdn.net/ganyingxie123456/article/details/70230486)

