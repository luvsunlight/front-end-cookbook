## TCP是什么

用大白话讲，TCP是一种计算机之间通信的协议，它处于IP协议的上游，IP协议只负责计算机之间的通信，即将信息在两个主机之间传递，具体传给谁不管，TCP和UDP这种网络层的协议就负责将物理层的数据包分发给具体的程序（端口号），TCP协议是一种面向流的可靠的网络传输协议

## TCP的特点

* 可靠
* 有连接

## TCP和UDP

* TCP协议有连接，即它需要建立连接才能通信，UDP则没有
* TCP传输有序
* TCP传输稳定
* TCP面向流，UDP面向报文
* TCP流占用空间更大
* TCP首部较大
* TCP可能阻塞，UDP不会
* TCP适合稳定传输，是大部分时候网络传输的底层协议，UDP适合比如直播，视频等要求实时不要求准确率的业务

## TCP的三次握手和四次挥手

### 三次握手的原理

用通俗的话来说，三次握手指的是建立一个TCP连接一共需要通信双方发送3个数据包

* 第一个包客户端发给服务端，服务端收到了，此时服务端知道自己可以收到客户端的消息
* 第二个包服务端发给客户端，客户端收到了，此时客户端知道自己可以给服务端发消息并能被接收到（第一个包），且自己也可以接收到服务端的消息
* 第三个包，客户端再给服务端发，服务端收到了，此时服务端也知道了自己既可以收到客户端的包（第一次发包），也可以给客户端发包并能被接受（第三个包）

### 为什么一定要三次握手

> 第一种思路

只有第二次握手时，此时服务端还不知道自己的消息能不能被客户端接受

> 第二种思路

我们考虑这样一种情况，客户端向服务端发起请求，第一次请求丢包了，于是客户端又发起了一次，但其实第一次请求只是在网络途中卡住了。过了很久才传到服务端，这个时候服务端以为是客户端又发起了请求（此时客户端重连的第二次请求已经断开了），于是服务端就给客户端也发了个包，这个时候客户端因为之前的连接已经断开了，是不会理这个包的，但是如果只有两次握手的话，服务端会以为本次握手成功，会白白浪费资源的

### 四次挥手的原理

* 首先客户端向服务端发起断开连接的请求
* 服务端接收到了，并向客户端发送包，客户端接收到后，处于不发包的状态，服务端这个时候还可以给客户端发包
* 服务端不再需要连接时，就会再给客户端发消息，告诉自己这边已经解决完了
* 客户端收到消息后，就给服务器发送消息，然后等待两个`最大报文存在时间`之后才处于断开连接状态
* 服务端收到客户端的消息之后断开连接

### 为什么要等待两个最大报文存在时间

我们知道了，第四次挥手客户端（发起方）有一个2倍最长报文存活时间，这个是防止客户端最后一个确认包，如果是这种情况客户端还要丢包重传。第三个包仅仅表示服务端没有包传过来了，但是不保证自己的包全部都传过去了

最后一次挥手的作用

* 确保自己的全部包都发送给了服务端
* 确保本地通信的全部包都已经消失，不会影响之后的通信

### 为什么一定要四次挥手

四次挥手的原理和三次握手是一样的，区别就在于中间，服务端需要向客户端发送两次消息，因为第一次只是告诉客户端我收到了这个消息，免得客户端丢包重发，但是这个时候服务端的包可能还没发完，还需要等待其包完全发完

